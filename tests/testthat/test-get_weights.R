skip_if_not_installed("lme4")

m1 <- lme4::lmer(mpg ~ am + (1 | cyl), data = mtcars)
m2 <- lm(mpg ~ am, data = mtcars)

test_that("get_weights", {
  expect_null(get_weights(m1))
  expect_null(get_weights(m2))
})

set.seed(123)
mtcars$w <- abs(rnorm(nrow(mtcars), sd = 0.5))

m1 <- lme4::lmer(mpg ~ am + (1 | cyl), data = mtcars, weights = w)
m2 <- lm(mpg ~ am, data = mtcars, weights = w)

test_that("get_weights", {
  expect_equal(
    get_weights(m1),
    mtcars$w,
    tolerance = 1e-2
  )
  expect_equal(
    get_weights(m2),
    mtcars$w,
    tolerance = 1e-2
  )
})

skip_if_not_installed("nlme")
data("Orthodont", package = "nlme")
m <- nlme::lme( # a model of variance only
  distance ~ 1,
  data = nlme::Orthodont, # grand mean
  weights = nlme::varConstPower(form = ~ age | Sex)
)

out <- get_weights(m)
test_that("get_weights nlme", {
  expect_identical(colnames(out), c("age", "Sex"))
})
